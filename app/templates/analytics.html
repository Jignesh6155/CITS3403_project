{% extends "base.html" %}
{% set active_page = "analytics" %}

{% block title %}Career Analytics Arena{% endblock %}

{% block content %}
<header class="px-6 py-4 bg-indigo-100 border-b border-gray-200 flex justify-between items-center">
  <h1 class="text-xl font-semibold text-indigo-900">Career Analytics Arena</h1>
  <div class="flex gap-4 items-center">
    <i data-lucide="bar-chart-3" class="w-5 h-5 text-gray-500"></i>
    <div class="w-8 h-8 bg-gray-300 rounded-full"></div>
  </div>
</header>

<main class="flex-1 p-6 grid grid-cols-1 lg:grid-cols-2 gap-6 overflow-y-auto">

  <!-- Log a Job Application Form -->
  <section class="bg-white border border-gray-200 p-6 shadow rounded-lg">
    <h2 class="text-lg font-semibold text-gray-800 mb-4">Log a Job Application</h2>
    <form class="space-y-4">
      <input type="text" placeholder="Company Name" class="w-full px-4 py-2 border border-gray-300 rounded focus:ring-indigo-500 focus:outline-none" />
      <select class="w-full px-4 py-2 border border-gray-300 rounded focus:ring-indigo-500 focus:outline-none">
        <option>Submitted</option>
        <option>Interviewed</option>
        <option>Offered</option>
        <option>Rejected</option>
      </select>
      <select class="w-full px-4 py-2 border border-gray-300 rounded focus:ring-indigo-500 focus:outline-none">
        <option disabled selected>Select Application Type</option>
        <option>Graduate Program</option>
        <option>Internship</option>
        <option>Full-Time Role</option>
        <option>Part-Time</option>
      </select>
      <input type="date" class="w-full px-4 py-2 border border-gray-300 rounded focus:ring-indigo-500 focus:outline-none" />
      <button class="w-full bg-indigo-600 text-white py-2 rounded hover:bg-indigo-700 transition">Add Entry</button>
    </form>
  </section>

  <!-- Your Career Stats Section -->
  <section class="bg-white border border-gray-200 p-6 shadow rounded-lg">
    <h2 class="text-lg font-semibold text-gray-800 mb-4">Your Career Stats</h2>
    <div class="grid grid-cols-2 gap-4 text-sm">
      <div class="bg-indigo-50 p-4 rounded shadow">
        <p class="text-xs text-gray-500 mb-1">Applications Sent</p>
        <p class="text-xl font-bold text-indigo-700">{{ applications_sent }}</p>
      </div>
      <div class="bg-indigo-50 p-4 rounded shadow">
        <p class="text-xs text-gray-500 mb-1">Interviews</p>
        <p class="text-xl font-bold text-indigo-700">{{ interviews }}</p>
      </div>
      <div class="bg-indigo-50 p-4 rounded shadow">
        <p class="text-xs text-gray-500 mb-1">Offers</p>
        <p class="text-xl font-bold text-indigo-700">{{ offers_count }}</p>
      </div>
      <div class="bg-indigo-50 p-4 rounded shadow">
        <p class="text-xs text-gray-500 mb-1">Avg. Response Time</p>
        <p class="text-xl font-bold text-indigo-700">{{ avg_response_time }} days</p>
      </div>
      <div class="bg-indigo-50 p-4 rounded shadow col-span-2">
        <p class="text-xs text-gray-500 mb-1">Success Rate</p>
        <p class="text-xl font-bold text-indigo-700">{{ '%.2f' % success_rate }}%</p>
      </div>
    </div>
    <p class="text-xs text-gray-500 italic mt-3 text-center">These stats are based on your recent logs.</p>
  </section>

  <!-- Career Performers and Stats Section -->
  <section class="col-span-1 lg:col-span-2 grid grid-cols-1 lg:grid-cols-3 gap-6">
    <div class="bg-white border border-gray-200 p-6 shadow rounded-lg col-span-2">
      <h2 class="text-lg font-semibold text-gray-800 mb-4">Top Career Performers</h2>
      <ul class="space-y-3 text-sm">
        <li class="bg-indigo-50 px-4 py-3 rounded-md flex justify-between">
          <span>🔥 <strong>User1</strong> — 5 Offers in 2 Weeks</span>
          <span class="text-green-600">Rank #1</span>
        </li>
        <li class="bg-indigo-50 px-4 py-3 rounded-md flex justify-between">
          <span>💼 <strong>User2</strong> — 3 Offers, 11 Interviews</span>
          <span class="text-yellow-500">Rank #2</span>
        </li>
        <li class="bg-indigo-50 px-4 py-3 rounded-md flex justify-between">
          <span>🚀 <strong>User3</strong> — Fastest Avg. Response (3 days)</span>
          <span class="text-blue-500">Rank #3</span>
        </li>
      </ul>
    </div>
    <div class="bg-white border border-gray-200 p-6 shadow rounded-lg">
      <h2 class="text-lg font-semibold text-gray-800 mb-4">Weekly Stats</h2>
      <div class="w-full h-40">
        <canvas id="appChart"></canvas>
      </div>
    </div>
  </section>

  <!-- Graphs for Offer vs Rejection, Application Type, and Status -->
  <section class="col-span-1 lg:col-span-2 grid grid-cols-1 lg:grid-cols-3 gap-6">
    <div class="bg-white border border-gray-200 p-6 shadow rounded-lg">
      <h2 class="text-lg font-semibold text-gray-800 mb-4">Offer vs Rejection Ratio</h2>
      <div class="w-full h-56">
        <canvas id="outcomeChart"></canvas>
      </div>
    </div>
    <div class="bg-white border border-gray-200 p-6 shadow rounded-lg">
      <h2 class="text-lg font-semibold text-gray-800 mb-4">Application Type Breakdown</h2>
      <div class="w-full h-56">
        <canvas id="typeChart"></canvas>
      </div>
    </div>
    <div class="bg-white border border-gray-200 p-6 shadow rounded-lg">
      <h2 class="text-lg font-semibold text-gray-800 mb-4">Application Status Distribution</h2>
      <div class="w-full h-56">
        <canvas id="statusChart"></canvas>
      </div>
    </div>
  </section>

  <!-- Your Badges -->
  <section class="col-span-1 lg:col-span-2 bg-white border border-gray-200 p-6 shadow rounded-lg">
    <h2 class="text-lg font-semibold text-gray-800 mb-4">Your Badges</h2>
    <div class="flex gap-4 flex-wrap text-sm">
      <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full">🌟 First Interview!</span>
      <span class="bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full">🏅 Offer Achieved</span>
      <span class="bg-purple-100 text-purple-800 px-3 py-1 rounded-full">📈 10 Applications Logged</span>
    </div>
    <p class="text-xs text-gray-500 mt-3 italic">More badges unlock as you progress 🚀</p>
  </section>

</main>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const ctx = document.getElementById('appChart').getContext('2d');
  new Chart(ctx, {
    type: 'line',  // Changed to line graph for weekly stats
    data: {
      labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
      datasets: [{
        label: 'Career Stats',
        data: [{{ applications_sent | safe }}, {{ interviews | safe }}, {{ offers_count | safe }}],
        backgroundColor: ['#6366f1', '#34d399', '#f97316'],
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { display: false }
      }
    }
  });

  new Chart(document.getElementById('outcomeChart'), {
    type: 'pie',
    data: {
      labels: ['Offers', 'Rejections'],
      datasets: [{
        data: [{{ offers_count | safe }}, {{ interviews | safe }}],
        backgroundColor: ['#4ade80', '#f59e0b'],
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { position: 'bottom' }
      }
    }
  });

  new Chart(document.getElementById('typeChart'), {
    type: 'doughnut',
    data: {
      labels: ['Graduate Program', 'Internship', 'Clerkship', 'Scholarship'],
      datasets: [{
        data: [{{ graduate_job | safe }}, {{ internship | safe }}, {{ clerkship | safe }}, {{ scholarship | safe }}],
        backgroundColor: ['#6366f1', '#10b981', '#f97316', '#f59e0b']
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { position: 'bottom' }
      }
    }
  });

  new Chart(document.getElementById('statusChart'), {
    type: 'bar',
    data: {
      labels: {{ status_labels | safe }},
      datasets: [{
        label: 'Applications by Status',
        data: {{ status_counts | safe }},
        backgroundColor: ['#6366f1', '#34d399', '#f97316', '#10b981', '#f59e0b', '#4ade80', '#e5e7eb']
      }]
    }
  });
</script>
{% endblock %}
