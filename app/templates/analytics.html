{% extends "base.html" %}
{% set active_page = "analytics" %}
{% block title %}Career Analytics Arena{% endblock %}
{% block content %}
<header class="px-6 py-4 bg-indigo-100 border-b border-gray-200 flex justify-between items-center">
  <h1 class="text-xl font-semibold text-indigo-900">Career Analytics Arena</h1>
  <div class="flex gap-4 items-center">
    <i data-lucide="bar-chart-3" class="w-5 h-5 text-gray-500"></i>
    <div class="w-8 h-8 bg-gray-300 rounded-full"></div>
  </div>
</header>
<main class="flex-1 p-6 space-y-6 overflow-y-auto">
  <!-- ── career-stats tiles ──────────────────────────────────────────── -->
  <section class="bg-white border border-gray-200 p-6 shadow rounded-lg">
    <h2 class="text-lg font-semibold text-gray-800 mb-4">Your Career Stats</h2>
    <div class="grid grid-cols-2 gap-4 text-sm">
      <div class="bg-indigo-50 p-4 rounded shadow">
        <p class="text-xs text-gray-500 mb-1">Applications Sent</p>
        <p class="text-xl font-bold text-indigo-700">{{ total_apps }}</p>
      </div>
      <div class="bg-indigo-50 p-4 rounded shadow">
        <p class="text-xs text-gray-500 mb-1">Interviews</p>
        <p class="text-xl font-bold text-indigo-700">{{ interviews }}</p>
      </div>
      <div class="bg-indigo-50 p-4 rounded shadow">
        <p class="text-xs text-gray-500 mb-1">Offers</p>
        <p class="text-xl font-bold text-indigo-700">{{ offers }}</p>
      </div>
      <div class="bg-indigo-50 p-4 rounded shadow">
        <p class="text-xs text-gray-500 mb-1">Avg. Response Time</p>
        <p class="text-xl font-bold text-indigo-700">
          {{ avg_response if avg_response is not none else "N/A" }} days
        </p>
      </div>
      <div class="bg-indigo-50 p-4 rounded shadow col-span-2">
        <p class="text-xs text-gray-500 mb-1">Success Rate</p>
        <p class="text-xl font-bold text-indigo-700">{{ success_rate }}%</p>
      </div>
    </div>
    <p class="text-xs text-gray-500 italic mt-3 text-center">
      Live figures from your Job-Tracker board
    </p>
  </section>
  <!-- ── graph layout: merged top-left panel ─────────────────────────── -->
  <section class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- 7-day activity AND cumulative apps stacked in one card -->
    <div class="bg-white border p-4 shadow rounded-lg lg:col-span-1">
      <h2 class="text-sm font-semibold mb-2">7-Day Activity</h2>
      <canvas id="appChart" class="w-full h-40 mb-6"></canvas>
      <h2 class="text-sm font-semibold mb-2">Cumulative Apps</h2>
      <canvas id="cumChart" class="w-full h-40"></canvas>
    </div>
    <!-- Offers vs Rejections -->
    <div class="bg-white border p-4 shadow rounded-lg">
      <h2 class="text-sm font-semibold mb-2">Offers vs Rejections</h2>
      <canvas id="outcomeChart" class="w-full h-48"></canvas>
    </div>
    <!-- Application Types -->
    <div class="bg-white border p-4 shadow rounded-lg">
      <h2 class="text-sm font-semibold mb-2">Application Types</h2>
      <canvas id="typeRadar" class="w-full h-64"></canvas>
    </div>
  </section>
</main>
{% endblock %}
{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const indigo='rgba(99,102,241,1)', indigoT='rgba(99,102,241,.15)';
const green ='rgba(34,197,94,1)',  greenT ='rgba(34,197,94,.15)';
const yellow='rgba(234,179,8,1)',  yellowT='rgba(234,179,8,.15)';
/* 7-day activity line */
new Chart(appChart,{
  type:'line',
  data:{labels:{{ weekly_labels|safe }},
        datasets:[
          {label:'Apps',data:{{ weekly_apps|safe }},
           borderColor:indigo,backgroundColor:indigoT,tension:.4},
          {label:'Interviews',data:{{ weekly_int|safe }},
           borderColor:green,backgroundColor:greenT,tension:.4},
          {label:'Offers',data:{{ weekly_off|safe }},
           borderColor:yellow,backgroundColor:yellowT,tension:.4}
        ]},
  options:{responsive:true,plugins:{legend:{display:false}},
           scales:{y:{beginAtZero:true}}}
});
/* cumulative apps */
new Chart(cumChart,{
  type:'line',
  data:{labels:{{ cum_labels|safe }},
        datasets:[{label:'Total',data:{{ cum_counts|safe }},
                   borderColor:indigo,backgroundColor:indigoT,fill:true,tension:.3}]},
  options:{responsive:true,plugins:{legend:{display:false}},
           scales:{y:{beginAtZero:true}}}
});
/* offers vs rejections */
new Chart(outcomeChart,{
  type:'pie',
  data:{labels:{{ outcome_labels|safe }},
        datasets:[{data:{{ outcome_counts|safe }},
                   backgroundColor:['#4ade80','#f87171']}]},
  options:{responsive:true,plugins:{legend:{position:'bottom'}}}
});
/* application types radar */
new Chart(typeRadar,{
  type:'radar',
  data:{labels:{{ type_labels|safe }},
        datasets:[{data:{{ type_counts|safe }},
                   backgroundColor:indigoT,borderColor:indigo}]},
  options:{responsive:true,plugins:{legend:{display:false}}}
});
</script>
{% endblock %}