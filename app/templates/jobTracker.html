{% extends "base.html" %}
{% set active_page = "job-tracker" %}

{% block title %}Job Tracker Board{% endblock %}

{% block content %}
<div class="flex-1 flex flex-col">
  <!-- HEADER + ADD APPLICATION BUTTON -->
  <header class="px-6 py-4 bg-indigo-100 border-b border-gray-200 flex justify-between items-center">
    <h1 class="text-xl font-semibold text-indigo-900">Your Job Tracker</h1>
    <button id="myBtn" class="px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700">
      + Add Application
    </button>
  </header>

  <!-- SEARCH BAR + FILTERS -->
  <main class="flex-1 p-6 overflow-y-auto">
    <div class="overflow-x-auto space-y-6">
      
      <!-- Search bar -->
      <div class="flex flex-wrap items-center gap-4 mb-6">
        <div class="flex items-center border rounded-full px-4 py-2 w-full md:w-1/2 bg-white">
          <i data-lucide="search" class="w-4 h-4 text-gray-400 mr-2"></i>
          <input type="text" placeholder="Search for roles or companies" class="flex-1 bg-transparent outline-none text-gray-700 placeholder-gray-400">
        </div>

        <div class="flex items-center gap-2">
          <input type="date" class="border rounded-md px-3 py-2 text-sm text-gray-700 bg-white">
          <span class="text-gray-400">â†’</span>
          <input type="date" class="border rounded-md px-3 py-2 text-sm text-gray-700 bg-white">
        </div>

        <select class="border rounded-md px-3 py-2 text-sm text-gray-700 bg-white">
          <option>Job Type</option>
          <option>Internship</option>
          <option>Graduate Role</option>
          <option>Full-Time</option>
          <option>Part-Time</option>
        </select>

        <select class="border rounded-md px-3 py-2 text-sm text-gray-700 bg-white">
          <option>Status</option>
          <option>Saved</option>
          <option>Applied</option>
          <option>Screen</option>
          <option>Interviewing</option>
          <option>Offer</option>
          <option>Accepted</option>
          <option>Archived</option>
          <option>Discontinued</option>
        </select>
      </div>

      <!-- TABLE -->
      <div class="border border-gray-300 rounded-lg overflow-hidden">
        <div class="overflow-x-auto" style="max-height: 500px;">
          <table id="jobTable" class="table-fixed w-full border-collapse">
            <thead class="bg-indigo-100 text-indigo-800">
              <tr>
                <th class="border border-gray-300 p-2">Saved</th>
                <th class="border border-gray-300 p-2">Applied</th>
                <th class="border border-gray-300 p-2">Screen</th>
                <th class="border border-gray-300 p-2">Interviewing</th>
                <th class="border border-gray-300 p-2">Offer</th>
                <th class="border border-gray-300 p-2">Accepted</th>
                <th class="border border-gray-300 p-2">Archived</th>
                <th class="border border-gray-300 p-2">Discontinued</th>
              </tr>
            </thead>
            <tbody id="tableBody" class="text-center">
              {% for i in range(10) %}
              <tr>
                {% for column in ["Saved", "Applied", "Screen", "Interviewing", "Offer", "Accepted", "Archived", "Discontinued"] %}
                <td class="border border-gray-300 p-6"></td>
                {% endfor %}
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>

    </div>
  </main>

  <!-- THE POPUP MODAL -->
  <div id="myModal" class="modal">
    <div class="modal-content p-8 rounded-lg shadow-lg bg-white w-full max-w-md mx-auto">
      <span class="close">&times;</span>
      <h2 class="text-xl font-semibold mb-4 text-indigo-900 text-center">Add Application</h2>
      <form id="applicationForm" class="flex flex-col gap-4">
        <input id="companyName" type="text" placeholder="Company Name" required class="border rounded-md p-2 text-gray-700">
        <input id="jobTitle" type="text" placeholder="Job Title" required class="border rounded-md p-2 text-gray-700">
        <input id="dateApplied" type="date" required class="border rounded-md p-2 text-gray-700">
        <select id="statusSelect" required class="border rounded-md p-2 text-gray-700">
          <option value="">Select Status</option>
          <option>Saved</option>
          <option>Applied</option>
          <option>Screen</option>
          <option>Interviewing</option>
          <option>Offer</option>
          <option>Accepted</option>
          <option>Archived</option>
          <option>Discontinued</option>
        </select>
        <button type="submit" class="mt-4 px-4 py-2 bg-indigo-600 text-white hover:bg-indigo-700 rounded-md">
          Add
        </button>
      </form>
    </div>
  </div>
</div>

<!-- POPUP CSS -->
<style>
.modal {
  display: none;
  position: fixed;
  z-index: 50;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgba(0,0,0,0.4);
}
.modal-content {
  position: relative;
  animation-name: animatetop;
  animation-duration: 0.4s
}
@keyframes animatetop {
  from {top: -300px; opacity: 0}
  to {top: 0; opacity: 1}
}
.close {
  color: black;
  float: right;
  font-size: 28px;
  font-weight: bold;
}
.close:hover, .close:focus {
  color: #000;
  text-decoration: none;
  cursor: pointer;
}
</style>
{% endblock %}

{% block scripts %}
<script>
// Popup open/close
var modal = document.getElementById("myModal");
var btn = document.getElementById("myBtn");
var span = document.getElementsByClassName("close")[0];

btn.onclick = function() { modal.style.display = "block"; }
span.onclick = function() { modal.style.display = "none"; }
window.onclick = function(event) { if (event.target == modal) { modal.style.display = "none"; } }

// Add job to table
document.getElementById("applicationForm").addEventListener("submit", function(e) {
  e.preventDefault();
  var company = document.getElementById("companyName").value;
  var job = document.getElementById("jobTitle").value;
  var date = document.getElementById("dateApplied").value;
  var status = document.getElementById("statusSelect").value;

  var colIndex = {
    "Saved": 0,
    "Applied": 1,
    "Screen": 2,
    "Interviewing": 3,
    "Offer": 4,
    "Accepted": 5,
    "Archived": 6,
    "Discontinued": 7
  }[status];

  if (colIndex === undefined) return;

  let placed = false;
  $("#tableBody tr").each(function() {
    const cell = $(this).find("td").eq(colIndex);
    if (cell.html().trim() === "") {
      cell.html(`
        <div class="flex flex-col items-center justify-center">
          <div class="font-bold text-gray-700">${job}</div>
          <div class="text-sm text-gray-500">${company}</div>
          <div class="text-xs text-gray-400">${date}</div>
        </div>
      `);
      placed = true;
      return false; // Break loop
    }
  });

  if (!placed) {
    alert("No space available in this column. Please add more rows.");
  }
  modal.style.display = "none";
  this.reset();
});
</script>
{% endblock %}